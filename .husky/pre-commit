#!/bin/sh

# Git pre-commit hook
# 在提交前自动验证文档同步

echo "🔍 检查文档同步..."

# 检查是否修改了源文件
if git diff --cached --name-only | grep -q '^src/.*\.js$'; then
  echo "检测到源代码变更，验证文档..."
  
  # 运行文档验证
  npm run docs:validate
  
  if [ $? -ne 0 ]; then
    echo ""
    echo "❌ 文档验证失败！"
    echo ""
    echo "请执行以下操作之一："
    echo "  1. 运行 'npm run docs:generate' 更新文档"
    echo "  2. 检查并完善源代码中的 JSDoc 注释"
    echo "  3. 使用 'git commit --no-verify' 跳过此检查（不推荐）"
    echo ""
    exit 1
  fi
  
  echo "✅ 文档验证通过"
fi

exit 0
