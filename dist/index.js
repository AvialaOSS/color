(function(f,d){typeof exports=="object"&&typeof module<"u"?d(exports,require("color")):typeof define=="function"&&define.amd?define(["exports","color"],d):(f=typeof globalThis<"u"?globalThis:f||self,d(f.AvialaColor={},f.Color))})(this,function(f,d){"use strict";function N(t){return d(t).rgb().round().color.join(",")}const U=["hex","rgb","hsl"];function K(t){return!t||!U.includes(t)?"hex":t}function D(t,n){const r=K(n);return r==="hex"?t[r]().toLowerCase():t[r]().round().string()}function B(t,n,r){const e=d(t),o=e.hue(),a=e.saturationv(),s=e.value(),i=(p=>p>=60&&p<=240?2.5:p>=0&&p<60||p>300&&p<=360?1.5:2)(o),h=100,m=9,u=100,l=30;function g(p,y){let L;return o>=60&&o<=240?L=p?o-i*y:o+i*y:L=p?o+i*y:o-i*y,L<0?L+=360:L>=360&&(L-=360),Math.round(L)}function b(p,y){let L;if(p)L=a<=m?a:a-(a-m)/5.5*Math.pow(y,1.05);else{const v=Math.min(h,a+30);L=a+(v-a)/4.2*Math.pow(y,.95)}return Math.max(0,Math.min(100,L))}function M(p,y){return p?Math.min(u,s+(u-s)/5.2*Math.pow(y,.9)):s<=l?s:Math.max(l,s-(s-l)/4.2*Math.pow(y,1.05))}const w=n<6,S=w?6-n:n-6,x=n===6?e:d({h:g(w,S),s:b(w,S),v:M(w,S)});return D(x,r)}function j(t,n,r){const e=d(B(t,10-n+1,"hex")),o=d(t),a=o.hue(),s=o.saturationv();function c(g){if(g<6)return h+(6-g)*u;if(g===6){if(a>=0&&a<50)return s-15;if(a>=50&&a<191)return s-20;if(a>=191&&a<=360)return s-15}return h-m*(g-6)}const h=d({h:o.hue(),s:c(6),v:o.value()}).saturationv(),m=Math.ceil((h-9)/4),u=Math.ceil((100-h)/5),l=d({h:e.hue(),s:c(n),v:e.value()});return D(l,r)}function $(t,n={}){const{dark:r,list:e,index:o=6,format:a="hex"}=n;if(e){const s=[],c=r?j:B;for(let i=1;i<=10;i++)s.push(c(t,i,a));return s}return r?j(t,o,a):B(t,o,a)}async function k(t){try{const n=await W(t),r=J(n);return Q(r)}catch(n){throw console.error("提取图片颜色失败:",n),n}}async function W(t){return new Promise((n,r)=>{try{if(typeof document>"u"){r(new Error("图像颜色提取功能仅在浏览器环境中可用"));return}const e=document.createElement("canvas"),o=e.getContext("2d");if(!o){r(new Error("无法获取canvas 2d context"));return}const a=Math.min(t.width,100),s=Math.min(t.height,100),c=Math.min(a/t.width,s/t.height);e.width=t.width*c,e.height=t.height*c,o.drawImage(t,0,0,e.width,e.height);const i=o.getImageData(0,0,e.width,e.height);n(i)}catch(e){r(e)}})}function J(t){const n=t.data,r=new Map;for(let o=0;o<n.length;o+=4){const a=n[o],s=n[o+1],c=n[o+2];if(n[o+3]<128)continue;const h=Math.round(a/16)*16,m=Math.round(s/16)*16,u=Math.round(c/16)*16,l=`${h},${m},${u}`;r.has(l)?r.set(l,r.get(l)+1):r.set(l,1)}const e=[];return r.forEach((o,a)=>{const[s,c,i]=a.split(",").map(Number);e.push({r:s,g:c,b:i,count:o})}),e}function Q(t){t.sort((o,a)=>a.count-o.count);const n=t.filter(o=>{const{r:a,g:s,b:c}=o,i=Math.max(a,s,c),h=Math.min(a,s,c),m=i-h,u=i===0?0:m/i,l=i/255;return u>.15&&l>.2&&l<.8}),r=n.length>0?n[0]:t[0];return d({r:r.r,g:r.g,b:r.b}).hex()}function X(t){return new Promise((n,r)=>{if(typeof FileReader>"u"||typeof Image>"u"){r(new Error("文件读取功能仅在浏览器环境中可用"));return}if(!t.type.startsWith("image/")){r(new Error("请选择图片文件"));return}const e=new FileReader;e.onload=async o=>{var a;try{const s=new Image;s.onload=async()=>{try{const i=await k(s);n(i)}catch(i){r(i)}},s.onerror=()=>r(new Error("图片加载失败"));const c=(a=o.target)==null?void 0:a.result;typeof c=="string"?s.src=c:r(new Error("无法读取图片数据"))}catch(s){r(s)}},e.onerror=()=>r(new Error("文件读取失败")),e.readAsDataURL(t)})}function A(t,n,r={}){const{steps:e=10,format:o="hex",includeEnds:a=!0}=r;if(e<2)throw new Error("步数必须至少为2");const s=d(t),c=d(n),i=[],h=a?e:e+2,m=1/(h-1);for(let u=0;u<h;u++){const l=u*m,g=Math.round(s.red()+(c.red()-s.red())*l),b=Math.round(s.green()+(c.green()-s.green())*l),M=Math.round(s.blue()+(c.blue()-s.blue())*l),w=d({r:g,g:b,b:M});!a&&(u===0||u===h-1)||i.push(D(w,o))}return i}function Y(t={}){const{startGray:n="#ffffff",endGray:r="#000000",steps:e=10,format:o="hex"}=t;return A(n,r,{steps:e,format:o,includeEnds:!0})}function C(t,n={}){const{steps:r=10,format:e="hex",lightnessRange:o=80,minLightness:a=null,maxLightness:s=null}=n,c=d(t);let i,h;if(a!==null&&s!==null){if(a>s)throw new Error("minLightness 不能大于 maxLightness");i=Math.max(0,Math.min(100,s)),h=Math.max(0,Math.min(100,a))}else{const l=c.lightness();i=Math.min(95,l+o/2),h=Math.max(5,l-o/2)}const m=d({h:c.hue(),s:c.saturationl(),l:i}),u=d({h:c.hue(),s:c.saturationl(),l:h});return A(m.hex(),u.hex(),{steps:r,format:e,includeEnds:!0})}function Z(t,n,r={}){const{steps:e=10,format:o="hex",includeEnds:a=!0}=r;if(e<2)throw new Error("步数必须至少为2");const s=d(t),c=d(n),i=[],h=a?e:e+2,m=1/(h-1);let u=s.hue()||0,l=c.hue()||0;const g=l-u;Math.abs(g)>180&&(g>0?u+=360:l+=360);const b=s.saturationl(),M=c.saturationl(),w=s.lightness(),S=c.lightness();for(let x=0;x<h;x++){const p=x*m;let y=u+(l-u)*p;const L=b+(M-b)*p,v=w+(S-w)*p;y=y%360,y<0&&(y+=360);const F=d({h:y,s:L,l:v});!a&&(x===0||x===h-1)||i.push(D(F,o))}return i}function R(t){if(!t||typeof t!="string")throw new Error("Invalid RGB color: must be a string");let n;try{n=d(t)}catch{throw new Error("Invalid RGB color format")}const r=n.l(),e=n.a(),o=n.b();let a=Math.atan2(o,e)*(180/Math.PI);a<0&&(a+=360);const s=Math.sqrt(e*e+o*o);return{h:a,c:s,t:r}}function E(t,n={}){if(!t||typeof t!="object"||t.h===void 0||t.c===void 0||t.t===void 0)throw new Error("Invalid HCT color: must be an object with h, c, t properties");const{gamutMapping:r="reduce-chroma"}=n;let{h:e,c:o,t:a}=t;e=(e%360+360)%360,o=Math.max(0,o),a=Math.max(0,Math.min(100,a));const s=e*(Math.PI/180),c=o*Math.cos(s),i=o*Math.sin(s);try{let h=d.lab(a,c,i);if(r==="reduce-chroma"){let b=o,M=h.rgb().array();for(;(M[0]<0||M[0]>255||M[1]<0||M[1]>255||M[2]<0||M[2]>255)&&b>0;){b-=1;const w=b*Math.cos(s),S=b*Math.sin(s);h=d.lab(a,w,S),M=h.rgb().array()}}const m=h.rgb().array(),u=Math.max(0,Math.min(255,Math.round(m[0]))),l=Math.max(0,Math.min(255,Math.round(m[1]))),g=Math.max(0,Math.min(255,Math.round(m[2])));return`#${u.toString(16).padStart(2,"0")}${l.toString(16).padStart(2,"0")}${g.toString(16).padStart(2,"0")}`}catch{return d.lab(a,c,i).hex().toLowerCase()}}function I(t,n,r=.5,e={}){if(!t||!n)throw new Error("Both colors are required for blending");const{mode:o="lab"}=e,a=Math.max(0,Math.min(1,r));return o==="lab"?_(t,n,a):o==="hue-only"?z(t,n,a):tt(t,n,a)}function _(t,n,r){const e=d(t),o=d(n),a=e.l(),s=e.a(),c=e.b(),i=o.l(),h=o.a(),m=o.b(),u=a+(i-a)*r,l=s+(h-s)*r,g=c+(m-c)*r;return d.lab(u,l,g).hex().toLowerCase()}function tt(t,n,r){const e=R(t),o=R(n),a=G(e.h,o.h,r),s=e.c+(o.c-e.c)*r,c=e.t+(o.t-e.t)*r;return E({h:a,c:Math.max(0,s),t:Math.max(0,Math.min(100,c))})}function z(t,n,r){const e=R(t),o=R(n),a=G(e.h,o.h,r);return E({h:a,c:e.c,t:e.t})}function G(t,n,r){let e=n-t;e>180?e-=360:e<-180&&(e+=360);let o=t+e*r;return o<0&&(o+=360),o>=360&&(o-=360),o}function nt(t,n){const r=d(t),e=d(n),o=r.l(),a=r.a(),s=r.b(),c=e.l(),i=e.a(),h=e.b();return Math.sqrt(Math.pow(c-o,2)+Math.pow(i-a,2)+Math.pow(h-s,2))}function et(t,n){const r=R(t);return E({h:r.h,c:r.c,t:Math.max(0,Math.min(100,n))})}function rt(t,n){const r=R(t);return E({h:r.h,c:Math.max(0,n),t:r.t})}function ot(t,n){const r=R(t);return E({h:(n%360+360)%360,c:r.c,t:r.t})}function T(t,n){const r=R(t);let e=r.h+n;return e=(e%360+360)%360,E({h:e,c:r.c,t:r.t})}function at(t){return T(t,180)}function st(t){return[t,T(t,120),T(t,240)]}function it(t,n=30){return[t,T(t,180-n),T(t,180+n)]}function ct(t,n=3,r=30){const e=[],o=-r*Math.floor(n/2);for(let a=0;a<n;a++)e.push(T(t,o+r*a));return e}function lt(t,n,r=.15){if(!t||!n)throw new Error("Both theme color and target color are required");const e=Math.max(0,Math.min(1,r));return z(n,t,e)}function ht(t,n){if(!t)throw new Error("Theme color is required");const r=R(t);let e;if(Array.isArray(n)?e=n:n&&n.tones&&Array.isArray(n.tones)?e=n.tones:e=[10,20,30,40,50,60,70,80,90],!Array.isArray(e)||e.length===0)throw new Error("Tone steps must be a non-empty array");const o=e.filter(a=>typeof a=="number"&&a>=0&&a<=100);if(o.length===0)throw new Error("No valid tone values found (must be numbers between 0-100)");return o.map(a=>E({h:r.h,c:r.c,t:a}))}function V(t,n,r=.2){if(!t)throw new Error("Theme color is required");if(!n||typeof n!="object")throw new Error("UI colors must be an object");const e=Math.max(0,Math.min(1,r)),o={};for(const[a,s]of Object.entries(n))try{o[a]=I(t,s,e)}catch(c){console.warn(`Failed to blend color for key "${a}": ${c.message}`),o[a]=s}return o}function q(t,n={}){if(!t)throw new Error("Theme color is required");const{baseGray:r="#989898",blendRatio:e=.08,isDark:o=!1,steps:a=12,lightnessRange:s=85,minLightness:c=null,maxLightness:i=null}=n,h=Math.max(0,Math.min(1,e)),m=Math.max(2,Math.min(100,Math.round(a))),u=I(r,t,h),l={steps:m,format:"hex"};if(c!==null&&i!==null)l.minLightness=c,l.maxLightness=i;else{const w=Math.max(20,Math.min(95,s));l.lightnessRange=w}const g=C(u,l),b=o?g.reverse():g,M={};return b.forEach((w,S)=>{M[`gray-${S+1}`]=w}),M}function P(t,n={}){if(!t)throw new Error("Theme color is required");const{semanticColors:r={success:"#52c41a",warning:"#faad14",error:"#ff4d4f",info:"#1890ff"},blendRatio:e=0,isDark:o=!1,steps:a=10,lightnessRange:s=80,minLightness:c=null,maxLightness:i=null}=n;if(!r||typeof r!="object")throw new Error("Semantic colors must be an object");const h=Math.max(0,Math.min(1,e)),m=Math.max(2,Math.min(100,Math.round(a))),u={};return Object.entries(r).forEach(([l,g])=>{if(!g||typeof g!="string"){console.warn(`Invalid color for semantic color "${l}": ${g}`);return}try{const b=I(g,t,h),M={steps:m,format:"hex"};if(c!==null&&i!==null)M.minLightness=c,M.maxLightness=i;else{const x=Math.max(20,Math.min(95,s));M.lightnessRange=x}const w=C(b,M);(o?w.reverse():w).forEach((x,p)=>{u[`${l}-${p+1}`]=x})}catch(b){console.warn(`Failed to generate variants for semantic color "${l}": ${b.message}`)}}),u}function O(t,n={}){if(!t)throw new Error("Theme color is required");const{isDark:r=!1,steps:e=10,lightnessRange:o=80,minLightness:a=null,maxLightness:s=null}=n,i={steps:Math.max(2,Math.min(100,Math.round(e))),format:"hex"};if(a!==null&&s!==null)i.minLightness=a,i.maxLightness=s;else{const l=Math.max(20,Math.min(95,o));i.lightnessRange=l}const h=C(t,i),m=r?h.reverse():h,u={};return m.forEach((l,g)=>{u[`theme-${g+1}`]=l}),u}function ut(t,n={}){if(!t)throw new Error("Theme color is required");const{baseGray:r="#666666",isDark:e=!1,semanticColors:o,controlBlendRatio:a=.08,semanticBlendRatio:s=.12,controlSteps:c=12,controlLightnessRange:i=85,controlMinLightness:h=null,controlMaxLightness:m=null,semanticSteps:u=10,semanticLightnessRange:l=80,semanticMinLightness:g=null,semanticMaxLightness:b=null,themeSteps:M=10,themeLightnessRange:w=80,themeMinLightness:S=null,themeMaxLightness:x=null}=n,p=Math.max(0,Math.min(1,a)),y=Math.max(0,Math.min(1,s)),L={baseGray:r,blendRatio:p,isDark:e,steps:c};h!==null&&m!==null?(L.minLightness=h,L.maxLightness=m):L.lightnessRange=i;const v={semanticColors:o,blendRatio:y,isDark:e,steps:u};g!==null&&b!==null?(v.minLightness=g,v.maxLightness=b):v.lightnessRange=l;const F={isDark:e,steps:M};return S!==null&&x!==null?(F.minLightness=S,F.maxLightness=x):F.lightnessRange=w,{controls:q(t,L),semantic:P(t,v),theme:O(t,F)}}function ft(t,n={}){if(!t)throw new Error("Theme color is required");const{semanticColors:r={success:"#52c41a",warning:"#faad14",error:"#ff4d4f",info:"#1890ff"},uiColors:e={background:"#ffffff",surface:"#fafafa",border:"#d9d9d9",disabled:"#f5f5f5"},harmonizeRatio:o=.15,blendRatio:a=.12,isDark:s=!1}=n,c=Math.max(0,Math.min(1,o)),i=Math.max(0,Math.min(1,a)),h=O(t,{isDark:s}),m=q(t,{blendRatio:i*.5,isDark:s}),u=P(t,{semanticColors:r,blendRatio:c,isDark:s}),l={};return Object.entries(r).forEach(([b])=>{l[b]={};for(let M=1;M<=10;M++){const w=`${b}-${M}`;u[w]&&(l[b][M]=u[w])}}),{theme:h,controls:m,semantic:l,ui:V(t,e,i)}}const H={red:"#F53F3F",orangered:"#F77234",orange:"#FF7D00",gold:"#F7BA1E",yellow:"#FADC19",lime:"#9FDB1D",green:"#00B42A",cyan:"#14C9C9",blue:"#3491FA",arcoblue:"#165DFF",purple:"#722ED1",pinkpurple:"#D91AD9",magenta:"#F5319D"};function mt(){const t={};return Object.keys(H).forEach(n=>{t[n]={},t[n].light=$(H[n],{list:!0}),t[n].dark=$(H[n],{list:!0,dark:!0}),t[n].primary=H[n]}),t.gray={},t.gray.light=["#f7f8fa","#f2f3f5","#e5e6eb","#c9cdd4","#a9aeb8","#86909c","#6b7785","#4e5969","#272e3b","#1d2129"],t.gray.dark=["#17171a","#2e2e30","#484849","#5f5f60","#78787a","#929293","#ababac","#c5c5c5","#dfdfdf","#f6f6f6"],t.gray.primary=t.gray.light[6],t}f.adjustChroma=rt,f.adjustHue=ot,f.adjustTone=et,f.blendInHct=I,f.blendUIColors=V,f.colorDifference=nt,f.colorList=H,f.extractColorFromFile=X,f.extractColorFromImage=k,f.generate=$,f.generateControlColors=q,f.generateGrayLinear=Y,f.generateInterfaceColorSystem=ut,f.generateLinear=A,f.generateLinearHSL=Z,f.generateMonochromeLinear=C,f.generateSemanticColors=P,f.generateThemeColors=O,f.generateThemePalette=ft,f.generateThemeVariants=ht,f.getAnalogous=ct,f.getComplementary=at,f.getPresetColors=mt,f.getRgbStr=N,f.getSplitComplementary=it,f.getTriadic=st,f.harmonizeColor=lt,f.hctToRgb=E,f.rgbToHct=R,f.rotateHue=T,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});
