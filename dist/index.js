(function(h,f){typeof exports=="object"&&typeof module<"u"?f(exports,require("color")):typeof define=="function"&&define.amd?define(["exports","color"],f):(h=typeof globalThis<"u"?globalThis:h||self,f(h.AvialaColor={},h.Color))})(this,function(h,f){"use strict";function P(t){return f(t).rgb().round().color.join(",")}const E=["hex","rgb","hsl"];function A(t){return!t||E.indexOf(t)<0?"hex":t}function D(t,e){const o=A(e);return o==="hex"?t[o]():t[o]().round().string()}function x(t,e,o){const a=f(t),r=a.hue(),n=a.saturationv(),s=a.value(),c=(l=>l>=60&&l<=240?2.5:l>=0&&l<60||l>300&&l<=360?1.5:2)(r),w=100,p=9,m=100,u=30;function b(l,d){let g;return r>=60&&r<=240?g=l?r-c*d:r+c*d:g=l?r+c*d:r-c*d,g<0?g+=360:g>=360&&(g-=360),Math.round(g)}function z(l,d){let g;if(l)g=n<=p?n:n-(n-p)/5.5*Math.pow(d,1.05);else{const O=Math.min(w,n+30);g=n+(O-n)/4.2*Math.pow(d,.95)}return Math.max(0,Math.min(100,g))}function H(l,d){return l?Math.min(m,s+(m-s)/5.2*Math.pow(d,.9)):s<=u?s:Math.max(u,s-(s-u)/4.2*Math.pow(d,1.05))}const M=e<6,S=M?6-e:e-6,L=e===6?a:f({h:b(M,S),s:z(M,S),v:H(M,S)});return D(L,o)}function v(t,e,o){const a=f(x(t,10-e+1)),r=f(t),n=r.hue(),s=r.saturationv(),c=f({h:r.hue(),s:m(6),v:r.value()}).saturationv(),w=Math.ceil((c-9)/4),p=Math.ceil((100-c)/5);function m(b){if(b<6)return c+(6-b)*p;if(b===6){if(n>=0&&n<50)return s-15;if(n>=50&&n<191)return s-20;if(n>=191&&n<=360)return s-15}return c-w*(b-6)}const u=f({h:a.hue(),s:m(e),v:a.value()});return D(u,o)}function y(t,e={}){const{dark:o,list:a,index:r=6,format:n="hex"}=e;if(a){const s=[],i=o?v:x;for(let c=1;c<=10;c++)s.push(i(t,c,n));return s}return o?v(t,r,n):x(t,r,n)}async function C(t){try{const e=await B(t),o=I(e);return q(o)}catch(e){throw console.error("提取图片颜色失败:",e),e}}async function B(t){return new Promise((e,o)=>{try{const a=document.createElement("canvas"),r=a.getContext("2d"),n=Math.min(t.width,100),s=Math.min(t.height,100),i=Math.min(n/t.width,s/t.height);a.width=t.width*i,a.height=t.height*i,r.drawImage(t,0,0,a.width,a.height);const c=r.getImageData(0,0,a.width,a.height);e(c)}catch(a){o(a)}})}function I(t){const e=t.data,o=new Map;for(let r=0;r<e.length;r+=4){const n=e[r],s=e[r+1],i=e[r+2];if(e[r+3]<128)continue;const w=Math.round(n/16)*16,p=Math.round(s/16)*16,m=Math.round(i/16)*16,u=`${w},${p},${m}`;o.has(u)?o.set(u,o.get(u)+1):o.set(u,1)}const a=[];return o.forEach((r,n)=>{const[s,i,c]=n.split(",").map(Number);a.push({r:s,g:i,b:c,count:r})}),a}function q(t){t.sort((r,n)=>n.count-r.count);const e=t.filter(r=>{const{r:n,g:s,b:i}=r,c=Math.max(n,s,i),w=Math.min(n,s,i),p=c-w,m=c===0?0:p/c,u=c/255;return m>.15&&u>.2&&u<.8}),o=e.length>0?e[0]:t[0];return f({r:o.r,g:o.g,b:o.b}).hex()}function N(t){return new Promise((e,o)=>{if(!t.type.startsWith("image/")){o(new Error("请选择图片文件"));return}const a=new FileReader;a.onload=async r=>{try{const n=new Image;n.onload=async()=>{try{const s=await C(n);e(s)}catch(s){o(s)}},n.onerror=()=>o(new Error("图片加载失败")),n.src=r.target.result}catch(n){o(n)}},a.onerror=()=>o(new Error("文件读取失败")),a.readAsDataURL(t)})}const F={red:"#F53F3F",orangered:"#F77234",orange:"#FF7D00",gold:"#F7BA1E",yellow:"#FADC19",lime:"#9FDB1D",green:"#00B42A",cyan:"#14C9C9",blue:"#3491FA",arcoblue:"#165DFF",purple:"#722ED1",pinkpurple:"#D91AD9",magenta:"#F5319D"};function R(){const t={};return Object.keys(F).forEach(e=>{t[e]={},t[e].light=y(F[e],{list:!0}),t[e].dark=y(F[e],{list:!0,dark:!0}),t[e].primary=F[e]}),t.gray={},t.gray.light=["#f7f8fa","#f2f3f5","#e5e6eb","#c9cdd4","#a9aeb8","#86909c","#6b7785","#4e5969","#272e3b","#1d2129"],t.gray.dark=["#17171a","#2e2e30","#484849","#5f5f60","#78787a","#929293","#ababac","#c5c5c5","#dfdfdf","#f6f6f6"],t.gray.primary=t.gray.light[6],t}h.colorList=F,h.extractColorFromFile=N,h.extractColorFromImage=C,h.generate=y,h.getPresetColors=R,h.getRgbStr=P,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
